{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–ª–æ–≥ –≥—Ä—É–ø–ø—ã PyE-242</title>
    <link rel="stylesheet" href="{% static 'css/posts.css' %}">
    <script src="{% static 'js/likes.js' %}"></script>
</head>
<body>
    <header>
        <h1>–ë–ª–æ–≥ –≥—Ä—É–ø–ø—ã <span class="group-name">PyE-242</span></h1>
    </header>

    <div class="main-wrapper">
        <main class="container">
            {% if post %}
                <div class="post">
                    <h2 class="post-title">{{ post.title }}</h2>
                    <div class="post-meta">
                        –ê–≤—Ç–æ—Ä: {{ post.user.username }} |
                        –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ post.date_publication|date:"d.m.Y H:i" }}
                    </div>
                    <div class="post-categories">
                        {% for category in post.categories.all %}
                            <span class="category">{{ category.title }}</span>
                        {% endfor %}
                    </div>
                    <div class="post-description">{{ post.description }}</div>
                    <div class="post-images">
                        {% for image in post.post_images.all %}
                            <img src="{{ image.image.url }}" alt="image" class="post-image">
                        {% endfor %}
                    </div>

                    <div class="post-reactions">
                        <form action="{% url 'post_reaction' pk=post.pk action='like' %}" method="post" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit">üëç {{ post.likes }}</button>
                        </form>
                        <form action="{% url 'post_reaction' pk=post.pk action='dislike' %}" method="post" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit">üëé {{ post.dislikes }}</button>
                        </form>
                    </div>

                    {% if author %}
                        <div class="form-delete">
                            <form action="" method="post">
                                {% csrf_token %}
                                <input type="submit" value="–£–¥–∞–ª–∏—Ç—å" class="btn-submit">
                            </form>
                        </div>
                    {% endif %}
                </div>

                <!-- –ë–ª–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
                {% for comment in post.post_comments.all %}
                    {% if not comment.parent %}
                        <div class="comment">
                            <div class="comment-meta">
                                {{ comment.user.username|default:"–ê–Ω–æ–Ω–∏–º" }} | {{ comment.date_created|date:"d.m.Y H:i" }}
                            </div>
                            <div class="comment-text">{{ comment.text }}</div>

                            <div class="comment-reactions">
                                <form action="{% url 'comment_reaction' pk=comment.pk action='like' %}" method="post" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit">üëç {{ comment.likes_count }}</button>
                                </form>
                                <form action="{% url 'comment_reaction' pk=comment.pk action='dislike' %}" method="post" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit">üëé {{ comment.dislikes_count }}</button>
                                </form>
                            </div>

                            {% if comment.child_comments.all %}
                                <div class="comment-replies">
                                    {% for reply in comment.child_comments.all %}
                                        <div class="comment-reply">
                                            <div class="comment-meta">
                                                {{ reply.user.username|default:"–ê–Ω–æ–Ω–∏–º" }} | {{ reply.date_created|date:"d.m.Y H:i" }}
                                            </div>
                                            <div class="comment-text">{{ reply.text }}</div>
                                            <div class="comment-reactions">
                                                <form action="{% url 'comment_reaction' pk=reply.pk action='like' %}" method="post" style="display:inline;">
                                                    {% csrf_token %}
                                                    <button type="submit">üëç {{ reply.likes_count }}</button>
                                                </form>
                                                <form action="{% url 'comment_reaction' pk=reply.pk action='dislike' %}" method="post" style="display:inline;">
                                                    {% csrf_token %}
                                                    <button type="submit">üëé {{ reply.dislikes_count }}</button>
                                                </form>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endif %}

                            <div class="reply-form">
                                <form action="{% url 'add_reply' comment.id %}" method="post">
                                    {% csrf_token %}
                                    <textarea name="text" rows="2" placeholder="–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                                    <button type="submit">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                                </form>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}

                <!-- –§–æ—Ä–º–∞ –Ω–æ–≤–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                <div class="new-comment-form">
                    <h4>–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
                    <form action="{% url 'add_comment' post.id %}" method="post">
                        {% csrf_token %}
                        <textarea name="text" rows="4" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    </form>
                </div>
            {% else %}
                <p>–ü–æ—Å—Ç–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>
            {% endif %}
        </main>
    </div>
</body>
</html>
